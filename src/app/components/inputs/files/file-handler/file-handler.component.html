<div class="p-2 rounded-lg flex items-center gap-3 bg-white border border-neutral-300">
  <div
    (click)="fileVysor.open()"
    (click)="openVysor()"
    class="rounded-md size-10 flex items-center justify-center shrink-0 cursor-pointer"
    [ngClass]="type === 'application/pdf' ? 'bg-sky-600' : 'bg-orange-500'"
  >
    @if (type === 'application/pdf') {
      <img src="/assets/icons/file-pdf.svg" alt="File" />
    } @else if (type === 'image/png' || type === 'image/jpg' || type === 'image/jpeg') {
      <img src="/assets/icons/file-image.svg" alt="Image" />
    } @else {
      <img src="/assets/icons/file.svg" alt="File" />
    }
  </div>

  <div class="grow cursor-pointer truncate">
    <a (click)="fileVysor.open()" (click)="openVysor()" class="truncate">{{ name }}</a>
    <div class="flex gap-2 items-center">
      <p class="text-neutral-400 text-sm">{{ kbFormatter.format(sizeInKb) }}</p>
      @if (withType) {
        <app-custom-select
          (ngModelChange)="setType($event)"
          [options]="types.options"
          [labels]="types.labels"
          [(ngModel)]="docType"
          placeholder="Select Type"
          inputClass="!py-0 text-sm !border-b-0"
        />
      }
    </div>
    @if (isUploading) {
      <div class="w-full rounded-full h-1.5 bg-gray-200">
        <div class="bg-secondary h-1.5 rounded-full" [style.width]="progressUpload + '%'"></div>
      </div>
    }
  </div>

  <div class="flex items-center justify-center gap-2">
    @if (isUploading) {
      <div class="text-emerald-500">{{ progressUpload }}%</div>
    }
    @if (progressUpload === 100) {
      <div>
        <img
          src="/assets/icons/check-icon.svg"
          width="20"
          height="20"
          alt="Loaded"
          style="filter: invert(68%) sepia(56%) saturate(3288%) hue-rotate(114deg) brightness(95%) contrast(101%)"
        />
      </div>
    }
    <button (click)="removeFile.emit()" class="shrink-0" type="button">
      <img src="/assets/icons/trash-icon.svg" width="14" height="16" alt="Delete" />
    </button>
  </div>
</div>

<app-modal #fileVysor (closed)="showFile.set(false)">
  @if (source && showFile()) {
    <button
      (click)="fileVysor.close()"
      (click)="showFile.set(false)"
      class="size-6 block ml-auto bg-secondary text-white"
      type="button"
    >
      X
    </button>
    @defer {
      <app-file-vysor [type]="type" [source]="source" />
    }
  }
</app-modal>
