<div
  class="p-4 rounded-lg shadow-md relative cursor-pointer transition-all duration-300"
  [ngClass]="config.noteLevel()[note.level]"
  [style.maxHeight]="expanded() ? 'none' : '190px'"
  style="overflow: hidden"
  (click)="expanded.set(!expanded())"
>
  <div class="text-sm mb-10 mt-4 break-all whitespace-pre-line" [ngClass]="{ 'line-clamp-3': !expanded() }">
    {{ note.description }}
  </div>

  <div [ngClass]="{ truncate: !expanded() }">
    <span class="text-sm font-medium" [ngClass]="{ truncate: !expanded() }">
      {{ note.author.first_name + ' ' + note.author.last_name }}
    </span>
    <div class="text-sm">{{ note.created_at | customDate }}</div>
  </div>

  @if (
    permissions.hasPermission(
      entityType === 'contact' ? permission.DELETE_CONTACT_NOTE : permission.DELETE_COMPANY_NOTE
    )
  ) {
    <button class="absolute top-4 right-4" (click)="deleteNote.open(); $event.stopImmediatePropagation()">
      <img
        src="/assets/icons/trash-icon.svg"
        width="14"
        height="16"
        alt="Delete"
        [ngClass]="{ invert: note.level !== 'INFO' }"
      />
    </button>
  }
</div>

<app-modal #deleteNote>
  <div class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 z-50">
    <div class="bg-white w-full max-w-md rounded-lg overflow-auto">
      <header class="p-4 flex justify-between items-center border-b border-gray-300">
        <h2 class="font-bold text-xl truncate">Delete Note</h2>
        <button (click)="deleteNote.close()" class="shrink-0">
          <img
            ngSrc="/assets/icons/close-icon.svg"
            width="14"
            height="18"
            alt="close"
            style="filter: invert(64%) sepia(1%) saturate(370%) hue-rotate(314deg) brightness(94%) contrast(91%)"
          />
        </button>
      </header>
      <div class="text-center p-6">
        <div class="flex justify-center">
          <div class="p-4 bg-red-100 rounded-full">
            <img src="/assets/icons/info.svg" alt="" class="size-12" />
          </div>
        </div>
        <h3 class="text-lg font-semibold text-gray-900 mt-4">Are you sure you want to delete this note?</h3>
        <p class="text-gray-500 mt-2">This action is irreversible</p>
        <div class="mt-6 flex flex-col md:flex-row justify-center gap-4">
          @if (!loading()) {
            <button class="bg-gray-200 text-gray-600 px-4 py-2 rounded-md" (click)="deleteNote.close()">Cancel</button>
            <button (click)="removeNote()" class="bg-red-600 text-white px-4 py-2 rounded-md">Proceed</button>
          } @else {
            <div class="h-full text-center flex justify-center items-center">
              <div class="loader"></div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</app-modal>
