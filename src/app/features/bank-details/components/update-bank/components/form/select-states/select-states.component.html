<div class="relative">
  <input
    [id]="seed + control.name"
    [name]="seed + control.name"
    (focus)="open.set(true)"
    class="peer w-full border-b-2 border-gray-300 focus:border-secondary outline-none text-gray-600 py-2 mb-2"
    type="text"
    placeholder=" "
    [value]="getSelectedText()"
    readonly
  />
  @if (label) {
    <label
      [for]="seed + control.name"
      class="absolute left-0 -top-3.5 text-gray-400 transition-all peer-placeholder-shown:top-2 peer-placeholder-shown:text-base text-sm peer-placeholder-shown:text-gray-400 peer-focus:-top-3.5 peer-focus:text-sm peer-focus:text-secondary cursor-pointer"
    >
      {{ label }}
    </label>
  }
</div>

<ul [ngClass]="{ hidden: !open() }" class="relative">
  <div class="absolute w-full z-10 bg-white top-0 left-0 shadow-lg p-3 border pb-0">
    <cdk-virtual-scroll-viewport itemSize="10" class="h-[150px]">
      <div class="mb-4 flex gap-4">
        <input
          class="w-full px-2 py-2 border-b-2 border-gray-300"
          [ngModel]="search()"
          (ngModelChange)="search.set($event)"
          [ngModelOptions]="{ standalone: true }"
          type="text"
          placeholder="Search..."
        />
      </div>

      @for (state of statesFiltered(); track $index) {
        <div>
          <div
            class="flex items-center"
            [ngClass]="{ 'bg-blue-100': isChecked(state.code), 'bg-white': !isChecked(state.code) }"
          >
            @let checked = isChecked(state.code);
            <input
              type="checkbox"
              [id]="seed + state.code"
              [checked]="checked"
              class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded"
              (change)="onCheckChange($event, state)"
            />
            <label [for]="seed + state.code" class="text-gray-600">{{ state.name }}</label>
          </div>
        </div>
      }
    </cdk-virtual-scroll-viewport>
  </div>
</ul>
<app-form-error-message class="w-100" [control]="control.control!" />
